var linen=function(){function p(h){function l(a){a=function(d){d=d.split("\n");var c=[],b;for(b in d){var e=/^(\*+|#+)\s+(.*)/.exec(d[b]);if(e){types={"*":"ul","#":"ol"};c.push({type:types[e[1][0]],indent:e[1].length,content:e[2]})}}return c}(a);return{type:a[0].type,extended:false,attrs:[],content:a}}function k(a){var d=[],c="",b=0,e=a[0];if(e=="f"&&a[b+1]=="n")c="f"+a[b+1];if(e=="*"||e=="#")return l(a);if(e=="b")c="b"+a[++b];if(e=="h")c="h"+a[++b];if(e=="p")if(a.slice(b,b+3)=="pre"){b+=2;c="pre"}else c=
"p";for(b++;b<a.length;b++){e=a[b];if(e==">")d.push(">");else if(e=="=")d.push("=");else if(e=="<")if(a[b+1]==">"){b++;d.push("<>")}else d.push("<");else if(e=="("){for(e=b;a[b++]!==")";);d.push(a.slice(e,b--))}else if(e=="["){for(e=b;a[b++]!=="]";);d.push(a.slice(e,b--))}else if(e=="{"){for(e=b;a[b++]!=="}";);d.push(a.slice(e,b--))}else return e=="."?{type:c,extended:a[b+1]==".",attrs:d,content:a.slice(++b,a.length).trim()}:{type:"p",attrs:[],extended:false,content:a.trim()}}return null}h=h.split(/\n\n+/);
var f=[],g;for(g in h)f.push(k(h[g]));return f}function n(h){return h.replace(/--/,"&#8212;").replace(/\n/,"<br/>").replace(/"([^"]*)"/,"&#8220;$1&#8221;").replace(/'([^']*)'/,"&#8216;$1&#8217;").replace(/'/,"&#8217;").replace(/ - /," &endash; ").replace(/\.\.\./,"&#8230;").replace(/\(r\)/,"&#174;").replace(/\(tm\)/,"&#8482;").replace(/\(c\)/,"&#169;").replace(/([A-Z]{2,})\(([^)]+)\)/,'<acronym title="$2">$1</acronym>').replace(/([A-Z]{2,})/,'<span class="caps">$1</span>').replace(/\?\?([^\?]+)\?\?/,
"<cite>$1</cite>").replace(/\*([^\*]+)\*/,"<strong>$1</strong>").replace(/\*\*([^\*]+)\*\*/,"<b>$1</b>").replace(/_([^_]+)_/,"<em>$1</em>").replace(/__([^_]+)__/,"<i>$1</i>").replace(/\+([^\+]+)\+/,"<ins>$1</ins>").replace(/-([^-]+)-/,"<del>$1</del>").replace(/\^([^\^]+)\^/,"<sup>$1</sup>").replace(/~([^~]+)~/,"<sub>$1</sub>")}function q(h){function l(g){if(g.type=="ol"||g.type=="ul"){for(var a=g.content,d=1,c=[],b=c,e=[],j=0;j<a.length;j++){var i=a[j];i.content=n(i.content);if(i.indent>d)for(var m=
0;m<i.indent-d;m++){e.push(b);var o=[];b.push(o);b=o}if(i.indent<d)for(m=0;m<d-i.indent;m++)b=e.pop();b.push(i);d=i.indent}return{type:g.type,content:c,classes:"",id:"",lang:"",style:"",alignment:""}}a={type:g.type,content:n(g.content),classes:"",id:"",lang:"",style:"",alignment:""};for(d in g.attrs){c=g.attrs[d];if(c[0]=="("){c=c.replace(/^\(/,"").replace(/\)$/,"").split("#");a.classes=a.classes==""?c[0]:a.classes+" "+c[0];if(c.length>1&&a.id=="")a.id=c[1]}else if(c[0]=="[")a.lang=c.replace(/^\[/,
"").replace(/\]$/,"");else if(c[0]=="{")a.style=c.replace(/^\{/,"").replace(/\}$/,"");else if(a.alignment==""){if(c==">")a.alignment="right";if(c=="<")a.alignment="left";if(c=="=")a.alignment="center";if(c=="<>")a.alignment="justify"}}return a}var k=[],f;for(f in h)k.push(l(h[f]));return k}function r(h){function l(f){function g(d){var c="";if(d.classes)c+='class="'+d.classes+'" ';if(d.id)c+='id="'+d.id+'" ';if(d.align)d.style="text-align: "+d.align+"; "+d.style;if(d.style)c+='style="'+d.style+'" ';
if(d.lang)c+='lang="'+d.lang+'" ';return c}function a(d){function c(b){var e="<"+b[0].type+">",j;for(j in b){var i=b[j];if(i.type){e+="<li>"+i.content;if(b[j+1]&&b[j+1].type==undefined)e+=c(b[++j]);e+="</li>"}else e+=c(i)}e+="</"+b[0].type+">";return e}return c(d.content)}switch(f.type){case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":return"<"+f.type+" "+g(f)+">"+f.content+"</"+f.type+">";case "bq":return"<blockquote "+g(f)+"><p>"+f.content+"</p></blockquote>";case "fn":return"<p"+g(f)+
"><sup>"+f.number+"</sup>"+f.content+"</p>";case "p":return"<p "+g(f)+">"+f.content+"</p>";case "bc":return"<pre "+g(f)+"><code>"+f.content+"</code></pre>";case "pre":return"<pre "+g(f)+">"+f.content+"</pre>";case "ul":case "ol":return a(f)}}ret="";for(var k in h)ret+=l(h[k])+"\n";return ret}return function(h){return r(q(p(h)))}}();if(exports){exports.linen=linen;exports.textilize=linen};
