var linen=function(){function s(b){function c(e){e=function(h){h=h.split("\n");var f=[],i;for(i in h){var g=/^(\*+|#+)(.*)/.exec(h[i]);if(g){types={"*":"ul","#":"ol"};var j=p(g[2]);f.push({type:types[g[1][0]],indent:g[1].length,content:j.content,attrs:j.attrs})}}return f}(e);return{type:e[0].type,extended:false,attrs:[],content:e}}function d(e){var h="",f=0,i=e[0];if(i=="f"&&e[f+1]=="n")h="f"+e[++f];if((i=="*"||i=="#")&&(e[1]==" "||e[1]=="\t"))return c(e);if(i=="|"){e=e.split("\n");h=[];var g,j;for(j in e){f=
e[j].replace(/^\|/,"").replace(/\|$/,"");i=p(f[0]);f[0]=i.content;if(j==0)g=i.attrs;h.push(f.split("|"))}return{type:"table",extended:false,attrs:g,content:h}}if(i=="b")h="b"+e[++f];if(i=="h")h="h"+e[++f];if(i=="p")if(e.slice(f,f+3)=="pre"){f+=2;h="pre"}else h="p";f++;g=p(e.slice(f,e.length));if(/^(\.+)/.exec(g.content)){g.type=h;g.content=g.content.replace(/^(\.+)/,"");g.extended=false;g.noBlock=false}else{g.type="p";g.content=e;g.extended=false;g.noBlock=true}return g}b=b.split(/\n\n+/);var a=[],
k;for(k in b){var l=d(b[k]);l&&a.push(l)}return a}function p(b){for(var c=[],d=0;d<b.length;d++){var a=b[d];if(a==">")c.push(">");else if(a=="=")c.push("=");else if(a=="<")if(b[d+1]==">"){d++;c.push("<>")}else c.push("<");else if(a=="("){for(a=d;b[d++]!==")"&&d<b.length;);c.push(b.slice(a,d--))}else if(a=="["){for(a=d;b[d++]!=="]"&&d<b.length;);c.push(b.slice(a,d--))}else if(a=="{"){for(a=d;b[d++]!=="}"&&d<b.length;);c.push(b.slice(a,d--))}else break}return{attrs:c,content:b.slice(d,b.length)}}function q(b){function c(a,
k,l){l=typeof l=="undefined"?"":" "+l;k=p(k);var e=n(k.attrs);return"<"+a+m({attrs:e})+l+">"+k.content+"</"+a+">"}function d(a){return a.slice(1,a.length-1)}return b.replace(/(\b)"([^"]*)(\b)"/g,"$1&#8220;$2&#8221;$3").replace(/"([^"]+)":(http\S+)/g,function(a,k,l){return c("a",k,'href="'+l+'"')}).replace(/!\b([^! \n]+)\b!:(http\S+)/g,function(a,k,l){return c("a"," "+c("img","",'src="'+k+'"'),'href="'+l+'"')}).replace(/!([^! \n]+)!/g,function(a){return c("img","",'src="'+d(a)+'"')}).replace(/--/g,
"&#8212;").replace(/\n/g,"<br/>").replace(/(\b)'([^']*)'(\b)/g,"$1&#8216;$2&#8217;$3").replace(/'/g,"&#8217;").replace(/ - /g," &#8211; ").replace(/\.\.\./g,"&#8230;").replace(/\(r\)/g,"&#174;").replace(/\(tm\)/g,"&#8482;").replace(/\(c\)/g,"&#169;").replace(/([A-Z]{2,})\(([^)]+)\)/g,'<span class="caps"><acronym title="$2">$1</acronym></span>').replace(/([A-Z]{2,})/g,function(a){return c("span",a+" ",'class="caps"')}).replace(/\?\?([^\?]+)\?\?/g,function(a){return c("cite",d(a))}).replace(/%([^%]+)%/g,
function(a){return c("span",d(a))}).replace(/(@[^@]+@)/g,function(a){return c("code",d(a))}).replace(/\*([^\*]+)\*/g,function(a){return c("strong",d(a))}).replace(/\*\*([^\*]+)\*\*/g,function(a){return c("b",d(a))}).replace(/\b_([^_]+)_\b/g,function(a){return c("em",d(a))}).replace(/\b__([^_]+)__\b/g,function(a){return c("i",d(a))}).replace(/\+([^\+]+)\+/g,function(a){return c("ins",d(a))}).replace(/-([^-]+)-/g,function(a){return c("del",d(a))}).replace(/\^([^\^]+)\^/g,function(a){return c("sup",
d(a))}).replace(/~([^~]+)~/g,function(a){return c("sub",d(a))})}function t(b){function c(k){for(var l=k.content,e=1,h=[],f=h,i=[],g=0;g<l.length;g++){var j=l[g];j.content=q(j.content);j.attrs=n(j.attrs);if(j.indent>e)for(var o=0;o<j.indent-e;o++){i.push(f);var r=[];f.push(r);f=r}if(j.indent<e)for(o=0;o<e-j.indent;o++)f=i.pop();f.push(j);e=j.indent}return{type:k.type,content:h,attrs:h[0].attrs,classes:"",id:"",lang:"",style:"",alignment:""}}var d=[],a;for(a in b)d.push(b[a].type=="ol"||b[a].type==
"ul"?c(b[a]):b[a].type=="table"?{type:"table",attrs:n(b[a].attrs),content:b[a].content,classes:"",id:"",lang:"",style:"",alignment:""}:b[a].type=="bc"?{type:b[a].type,content:b[a].content.replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/"/g,"&#34;"),attrs:n(b[a].attrs)}:{type:b[a].type,content:q(b[a].content),attrs:n(b[a].attrs)});return d}function n(b){var c={classes:"",id:"",lang:"",style:"",alignment:""},d;for(d in b){var a=b[d];if(a[0]=="("){a=a.replace(/^\(/,"").replace(/\)$/,"").split("#");
c.classes=c.classes==""?a[0]:c.classes+" "+a[0];if(a.length>1&&c.id=="")c.id=a[1]}else if(a[0]=="[")c.lang=a.replace(/^\[/,"").replace(/\]$/,"");else if(a[0]=="{")c.style=a.replace(/^\{/,"").replace(/\}$/,"");else if(c.alignment==""){if(a==">")c.alignment="right";if(a=="<")c.alignment="left";if(a=="=")c.alignment="center";if(a=="<>")c.alignment="justify"}}return c}function m(b){var c=" ";b=b.attrs;if(b.classes)c+='class="'+b.classes+'" ';if(b.id)c+='id="'+b.id+'" ';if(b.align)b.style="text-align: "+
b.align+"; "+b.style;if(b.style)c+='style="'+b.style+'" ';if(b.lang)c+='lang="'+b.lang+'" ';return c.slice(0,c.length-1)}function u(b){function c(a){function k(e){var h="<table"+m(e)+">",f;for(f in e.content){var i=e.content[f];h+="<tr>";for(var g in i)h+="<td>"+i[g]+"</td>";h+="</tr>"}h+="</table>";return h}function l(e){function h(f){var i="<"+f[0].type+m(f[0])+">",g;for(g in f){var j=f[g];if(j.type){i+="<li>"+j.content;if(f[g+1]&&f[g+1].type==undefined)i+=h(f[++g]);i+="</li>"}else i+=h(j)}i+="</"+
f[0].type+">";return i}return h(e.content)}switch(a.type){case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":return"<"+a.type+m(a)+">"+a.content+"</"+a.type+">";case "bq":return"<blockquote"+m(a)+"><p>"+a.content+"</p></blockquote>";case "fn":return"<p"+m(a)+"><sup>"+a.number+"</sup>"+a.content+"</p>";case "p":return"<p"+m(a)+">"+a.content+"</p>";case "bc":return"<pre"+m(a)+"><code>"+a.content+"</code></pre>";case "pre":return"<pre"+m(a)+">"+a.content+"</pre>";case "table":return k(a);case "ul":case "ol":return l(a)}}
ret="";for(var d in b)ret+=c(b[d])+"\n";return ret}return function(b){return u(t(s(b)))}}();if(typeof exports!="undefined"){exports.linen=linen;exports.textilize=linen};
